---
title: "R Notebook"
output: output:
  html_document:
    code_folding: hide
---

```{r}
#loading in Libraries
library(tidyverse)
library(tsibble)
library(tsibbledata)
library(skimr)
library(lubridate)
library(ggplot2)
library(leaflet)
```

```{r}
#cleaning/wrangling dataset
# add multiple columns to group per time period:
nyc_bikes_dates <- nyc_bikes %>% 
  mutate(year = year(start_time),
         month = month(start_time, label = TRUE, abbr = TRUE),
         day = day(start_time),
         weekday = wday(start_time, label = TRUE, abbr = TRUE))

# add age groups:
# let's add age to the dataset, and divide per age group
  # 0-17, 18-25, 26-35, 35-50, 50-65, 66-up
nyc_bikes_dates_age <- nyc_bikes_dates %>% 
    mutate(age = 2018 - birth_year) %>% 
  mutate(age_group = case_when(
    age < 18 ~ "0-17",
    age >= 18 & age <= 25 ~ "18-25",
    age > 25 & age <= 35 ~ "26-35",
    age > 35 & age <= 50 ~ "36-50",
    age > 50 & age <= 65 ~ "50-65",
    age > 65 ~ "66-up"
  ))

```



## Introduction

### About the company
"Citi Bike" is a bike rental company in New York City launched in 2013.
Bikes can be rented from docking stations across a network
throughout the city. <br>
Bikes can be returned at any station of choice. 
<br>

Bike hire prices are fixed for 30 minutes, with a fixed amount per minute after.
People with a subscription get the first 45 minutes per day for free. <br>
<br>

__Current level of bike rentals__
In 2018 we have seen a total of 4268 bikes being rented

```{r}
nyc_bikes_dates %>% 
  index_by(year) %>% 
  summarise(total_rentals = n())
```
__Area of activity__
Citi Bike is currently available and active in the Jersey City area.
The following map shows the location of users renting bikes in 2018.
```{r}
leaflet(nyc_bikes) %>% 
  addTiles() %>% 
  addCircleMarkers(
    lng = ~ start_long,
    lat = ~ start_lat,
    clusterOptions = markerClusterOptions()
  )
```

Based on this plot we see that highest popularity for bike hires is in Jersey City. 
By zooming in we see that the Christopher Columbus Drive station is the most 
popular station to rent a Citi Bike.

#### __Aim of this report__
This report aims to provide insight into "Citi Bike's" Key Performance Indicators.
The analysis provides information about peak rental periods: moments in time when 
bikes are most popular to rent. Further, customer demographics are analysed providing
information about the type/group of customers interested in bike hires.
<br>
This will provide actionable insights as it gives information about periods in time 
when bike hires are low and customer groups that are less likely to hire bikes, 
based on the 2018 dataset. 
<br>
In short, this report tries to answer the question:<br>
__To who and when do we need to address our campaigns in order to increase our bike hires?__
<br>
The conclusions drawn from this report can be used by the commercial/advertisement 
team to focus on customers that are currently not regularly using bike rentals.
Furthermore, Citi Bike's future campaigns should focus on popularizing bike rentals at 
times we currently see low bike rental popularity.

#### __Ethics__
Important to highlight is that data ethics have been taken into consideration during
the analyses of the data. <br>
  - All data is anonymised and cannot be traced back to individual customers;
  - We have further looked at underrepresented groups among the customers.
  
## Analyses
### When are Citi Bike's being hired?
We have focused on analysing the peak and off-peak periods for popularity of 
bike hires. <br>
Increasing bike hires can be achieved by focussing on popularising (e.g. by 
advertisements of discounts) during these off-peak periods.
<br>
We have focussed on the following periods in time: <br>
  * Year <br>
  * Month <br>
  * Season <br>
  * Weekdays <br>
  * Hours <br>
  
#### 1. Year, Month and Season

By plotting the total number of bike hires throughout the year, we can identify 
periods of low popularity (flat line).
```{r}
nyc_bikes_dates %>%
  arrange(start_time) %>% 
  mutate(trip_accumulative = row_number()) %>% 
  ggplot() +
  aes(x = start_time, y = trip_accumulative, group = ) +
  geom_line(col = "springgreen4") +
  ggtitle("Total bike hires in 2018") +
  ylab("Total hires") +
  xlab("Time") +
  theme_light()
```
This line graph shows the cumulative number of bike hires throughout 2018.
A reassuring graph as it shows there is a constant number of bikes being rented
throughout the year. The flatter the line, the lower number of rentals. We can clearly 
see that the line is not a continuous increasing line which shows the importance of 
understanding the causes of "periods of low popularity".
<br>
The line is steeper during the period between May and September, which is clearer 
when plotting total number of bike hires per month:

```{r}
nyc_bikes_dates %>% 
  index_by(month) %>% 
  summarise(rental_per_month = n()) %>% 
  ggplot() +
  aes(x = month, y = rental_per_month) +
  geom_col(col = "black", fill = "springgreen4") +
  ggtitle("Total bike hires per month") +
  ylab("Total hires\n") +
  xlab("\n2018") +
  theme(panel.grid.major.x = element_blank(),
              panel.grid.minor.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(size = 0.3, colour = "black"))

```
* This bar plot shows the number of bike hires per month in 2018. We can see that 
    bike hires peak in August with over 700 bike hires, while the lowest number of bikes
    are rented in February with just over 100 bike hires.
* For the bike rental company it is important to know which month's are least popular 
    for bike rentals because the commercial/advertisement team could focus on the least 
    popular months to attract more customers.
    Further, the customer team can focus on the most busy months in terms of improving customer
    experience in successful months in order not to loose customers due to heavy demands.
<br>

The above graph indicates that bike rental popularity is likely linked to weather 
conditions. This is clearer when we divide the rental data per season:

```{r}
# lets check per season, with (Dec, Jan, Feb = Winter); (Mar, Apr, May = Spring); (Jun, Jul, Aug = Summer); (Sep, Okt, Nov: Autumn) 
nyc_bikes_dates %>% 
  mutate(season = recode(month,
                        "Jan" = "Winter",
                        "Feb" = "Winter",
                        "Mar" = "Spring",
                        "Apr" = "Spring",
                        "May" = "Spring",
                        "Jun" = "Summer",
                        "Jul" = "Summer",
                        "Aug" = "Summer",
                        "Sep" = "Autumn",
                        "Oct" = "Autumn",
                        "Nov" = "Autumn",
                        "Dec" = "Winter")) %>% 
  index_by(season) %>% 
  summarise(rental_per_season = n()) %>% 
  ggplot() +
  aes(x = season, y = rental_per_season) +
  geom_col(col = "black", fill = "springgreen4") +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(size = 0.3, colour = "black")) +
  ggtitle("Total bike hires per season") +
  ylab("Total hires\n") +
  xlab("\n2018")
```
* This bar plot shows the number of bike hires per season in 2018. We can see that 
    bike hires peak during the Summer with over 1750 bike hires, while the lowest number of bikes
    are rented during Winter with less than 500 bike hires.
* For the bike rental company it is important to know which seasons are least popular 
    for bike rentals because the commercial/advertisement team can focus on the least 
    popular seasons to attract more customers.
    
Based on the per-month plot we suggested that in seasons with nice weather rental numbers peak.
However, in spring we generally see better weather than in autumn and still rental 
numbers in Spring are second lowest. This can be a great opportunity for the 
advertisement team to focus on!
<br>

#### 2. Day and Hour
When we look at most popular days for bike rentals we clearly see that working days
are more popular than the weekends.

```{r}
nyc_bikes_dates %>% 
  index_by(weekday) %>% 
  summarise(rental_per_weekday = n()) %>% 
  ggplot() +
  aes(x = weekday, y = rental_per_weekday) +
  geom_col(col = "black", fill = "springgreen4") +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(size = 0.3, colour = "black")) +
  ggtitle("Total bike hires per day") +
  ylab("Total hires\n") +
  xlab("\n2018")
```
* This bar plot shows the total number of bike hires per weekday in 2018. We can see that 
    bike hires are most popular on Tuesdays with over 700 bike hires, while the lowest number of bikes
    are rented on Sundays with ~450 bike hires.
* For the bike rental company it is important to know which day's are least popular 
    for bike rentals because the commercial/advertisement team could focus on the least 
    popular days to attract more customers.
    Interestingly, most popular day to rent a bike is on a weekday while the least popular 
    day is a day in the weekend! A great focus could be to advertise weekend 
    activities, like sightseeing trips, per bike.
<br>    
Bike hires are not equally divided during the week. What are off-peak times during 
the day?
```{r}
nyc_bikes_dates %>% 
  mutate(hour = hour(start_time)) %>% 
  ggplot() +
  aes(x = hour) +
  geom_bar(col = "black", fill = "#F9A472") +
  facet_wrap(~weekday, ncol =4) +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(size = 0.3, colour = "black")) +
  ggtitle("Total bike hires per hour per day") +
  ylab("Total hires\n") +
  xlab("Hour of day")
```
* This bar plot shows the total number of bike hires per weekday split per start 
    time (in hours). 
    We can see that bike hires are most popular during rush hour on weekdays. While Saturday and 
    Sunday show a more unimodal distribution of bike rental popularity during the day.
* For the bike rental company it is important to know which hours of the day bikes 
    are most popular to rent. For the operational team it is importance to have as much 
    bikes available as possible during rush hours. But for the advertisement team
    it is important to realise that it might be smart to focus on tourists during the day
    to increase hires.

We have looked at when rental bikes are most popular in order for the advertisement
team to know which off-peak periods should be popularised. 
Furthermore, the peak periods are informative for the operational team to have plenty of bikes 
ready to rent out.

Besides renting times, it is important to know who is renting bikes?

### Who are renting Citi Bike's?
We have analysed the demographics of customers renting bikes.

#### 1. Gender
We have first looked at gender:
```{r}
nyc_bikes_dates %>% 
  ggplot() +
  aes(x = gender, y = after_stat(prop), group = 1) +
  geom_bar(fill = "#3182bd") +
  xlab("\nGender") +
  ylab("Percentage\n") +
  ggtitle("Percentage of gender types renting bikes in 2018") +
  scale_y_continuous(labels = scales::percent_format()) +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(size = 0.3, colour = "black")) +
  scale_fill_manual(
    values = c(
      "Unknown" = "#B6A7B5",
      "Male" = "#F9A472",
      "Female" = "#fff7bc"
    ))
```
* This bar plot shows the total number of bikes hired per gender type in 2018. 
  We can see that bike hires are most popular among males than females.
    Bike hires are more than double as popular to rent by males than females.
* Populaity of bike hire difference between gender is valuable for the rental company 
  to know as the commercial/advertisement team could focus on the females to make bike
  renting more popular among females.
  
* Futhermore, important here is to send the information also to the customer team, 
  to further investigate this difference. 
  The underlying cause can namely be that females feel unsafe renting a bike, this 
  needs to be addressed and investigated further!
  
When we plot our daily bike rental plot and divide per gender we see that males are 
actually causing the workday/business day difference. While bike usage among females
are stable across the week:
```{r}
nyc_bikes_dates %>% 
  ggplot() +
  aes(x = weekday) +
  geom_bar(fill = "#3182bd") +
  facet_wrap(~ gender) +
  xlab("\nDays") +
  ylab("Total hires\n") +
  ggtitle("Percentage of gender types renting bikes in 2018") +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(size = 0.3, colour = "black"))
```
* This bar plot shows the total number of bike hires per weekday in 2018, divided 
    per gender. We can see that bike hires are most popular among males than females.
    For females there is hardly a difference in bike rentals between days.
    The pattern visible here (males with clear distinction between workday and weekend)
  indicates that males potentially use bikes to commute to work. While this is 
  absent in females. 
* This is a good opportunity for the advertisement/sales department to promote.

#### 2. Age groups
Besides gender we have looked at the age groups making use of Citi bike, bike rental:
```{r}
nyc_bikes_dates_age %>% 
  ggplot() +
  aes(x = age_group, y = after_stat(prop), group = 1) +
  geom_bar(fill = "#de2d26") +
  xlab("\nAge group") +
  ylab("Percentage\n") +
  ggtitle("Percentage of age groups renting bikes in 2018") +
  scale_y_continuous(labels = scales::percent_format()) +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(size = 0.3, colour = "black"))
```

* This bar plot shows the proportion of age groups making use of Citi Bike rentals.
  Age groups have been created based on setting age boundaries between -roughly- 
  different generations.
  We see that the highest percentage of users are millenials aged between 26-35, 
  followed by 36-50 year old's. Young adults (aged 18-25) and older generations (50 and up)
  only form less than 20% of the total customer base.
* This information is important for the commercial/advertisement team to know: bike
  rental numbers can be increased if we promote bike rentals among the youth and 
  elderly. This can potentially be reached by an add campaign.

#### 3. User
Among the Citi Bike customer base there are two types of customers:

* 1. Subscribers. Customers with a subscription pay a monthly fee and get the first 
45 minutes of every trip free. After 45 minutes a fixed rate per minute is charged.
    
* 2. Regular customers. Regular customers pay a fixed amount for every first 30 minutes 
of each trip. After 30 minutes a fixed rate per minute is charged.
  
```{r}
nyc_bikes_dates_age %>% 
  ggplot() +
  aes(x = weekday) +
  geom_bar(fill = "#fa9fb5") +
  facet_wrap(~ type) +
  xlab("\nDays") +
  ylab("Total hires\n") +
  ggtitle("Percentage of user types renting bikes in 2018") +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(size = 0.3, colour = "black"))

```

This bar plot shows the number of bike hires done by regular customers and those
with a subscription for each day of the week. 
The majority of the customer base are customers with a subscription. This is positive
for the company as they bring in a stable revenue.
Only a small proportion of bike renters are regular customers. Based on the activity
per day we see that subscribing customers are more regularly rent bikes during 
workdays indicating that subscribers use Citi Bike's to commute to work.


#### 4. Trip length
Finally, we have looked at trip length of bike rentals. We have filtered on trips
less than one hour (taking out extreme outliers of multiple hours). 

```{r}
nyc_bikes_dates_age %>%
  mutate(trip_time = stop_time - start_time) %>% 
  mutate(time_hours = as.numeric(trip_time, "hours")) %>% 
  filter(time_hours <= 1) %>% 
  ggplot() +
  aes(x = time_hours) +
  geom_histogram(fill = "springgreen4") +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.background = element_blank(),
        panel.grid.major.y = element_line(size = 0.3, colour = "black")) +
  ggtitle("Trip length for bike hires less than one hour") +
  ylab("Total hires\n") +
  xlab("\nTime")

```
* Based on this barplot we see the number of bike hires divided per trip length.
  We see that the far majority of trips are less than 30 minutes, with most trips 
  taking around 10 minutes.
* This information is very useful and confirms that having a fixed amount to be payed
  for a longer trip than the average trip length is a commercial attractive model
  as it generates more revenue than when charged for every minute. 
  Further, it is adviced to increase popularity of longer trips (more than 30 minutes)
  as we see that only few people are using bikes for longer trip and with a per-minute 
  rate every additional minute spend on a bike creates more revenue.
  
## Conclusions / key points





Introduction

-> Something about the company

-> Current level of bike rentals
-> where active?

-> Business question
-> Approach
    Where and when can we attract more customers?
    Logistical advice to run the company more efficient
-> Consideration of data ethics

Analysis

-> looked at bike rental timings, when most popular when least?

-> why of interest?

-> looked at demographics, among which groups are bike rentals most popular?
  who least?
  
-> why of interest?

Conclusions
