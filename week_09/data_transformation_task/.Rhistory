across(where(is.numeric(is.na(.x))),
~ median(.x, na.rm = TRUE))))
across(where(is.numeric,
customers %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE))))
customers %>%
customers
customers %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE))))
customers
customers %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE))))
customers
?across
customers %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(is.na(.x), na.rm = TRUE))))
customers %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(is.na(.x)))))
customers %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = FALSE))))
customers %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric & is.na(x)),
~ median(.x, na.rm = TRUE))))
customers %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric & is.na(.x)),
~ median(.x, na.rm = TRUE))))
across(where(is.numeric & NA,
across(where(is.numeric,
customers %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE))))
customers %>%
customers %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE))))
?coalesce
customers %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(customer_age, na.rm = TRUE))))
customers %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE))))
customers
customers %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE))))
# load in dataset
toy_transactions <- read_csv("raw_data/toy_transactions.csv")
# create the column date from day, month, year
toy_transactions_date <- toy_transactions %>%
mutate(date = make_datetime(year, month, day), .before = day)
toy_transactions_date
# create the column date from day, month, year
transactions <- toy_transactions %>%
mutate(date = make_datetime(year, month, day), .before = day)
toy_details <- toys_weight %>%
mutate(product_name = str_extract(product, "- [:alpha:]+ ?[:alpha:]*")) %>%
mutate(product_title = str_extract(product, "^[:alpha:]*.?[:alpha:]*.?[:alpha:]*")) %>%
mutate(product_name = str_replace(product_name, "^- ", replacement = "")) %>%
mutate(product_title = str_replace(product_title, " -$", replacement = ""))
toys <- read_csv("raw_data/toys.csv")
toys_weight <- toys %>%
mutate(weight = str_replace(weight, "[g]", replacement = "")) %>%
mutate(weight = as.numeric(weight)) %>%
rename(weight_g = weight)
toy_details <- toys_weight %>%
mutate(product_name = str_extract(product, "- [:alpha:]+ ?[:alpha:]*")) %>%
mutate(product_title = str_extract(product, "^[:alpha:]*.?[:alpha:]*.?[:alpha:]*")) %>%
mutate(product_name = str_replace(product_name, "^- ", replacement = "")) %>%
mutate(product_title = str_replace(product_title, " -$", replacement = ""))
quality_raw <- read_csv("raw_data/quality.csv")
quality_raw %>%
mutate(description = str_replace(description, "^Quality: ", replacement = "")) %>%
# 2. Replace the categories so ‘Awesome’ and ‘Very Awesome’ become ‘Good’ and
# ‘Very Good’. Do the same thing for ‘Awful’ replacing it with ‘Bad’.
mutate(description = recode(description,
"Very Awesome" = "Very Good",
"Awesome" = "Good",
"Awful" = "Bad",
"Very Awful" = "Very Bad"))
quality <- quality_raw %>%
mutate(description = str_replace(description, "^Quality: ", replacement = "")) %>%
# 2. Replace the categories so ‘Awesome’ and ‘Very Awesome’ become ‘Good’ and
# ‘Very Good’. Do the same thing for ‘Awful’ replacing it with ‘Bad’.
mutate(description = recode(description,
"Very Awesome" = "Very Good",
"Awesome" = "Good",
"Awful" = "Bad",
"Very Awful" = "Very Bad"))
# create the dataframe combining all customer csv's
customers_all <- dir_ls("raw_data/", regexp = "customers.csv$") %>%
map_dfr(read_csv)
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE))))
transactions
customers_all
quality
toy_details
?select
toy_details <- toys_weight %>%
mutate(product_name = str_extract(product, "- [:alpha:]+ ?[:alpha:]*")) %>%
mutate(product_title = str_extract(product, "^[:alpha:]*.?[:alpha:]*.?[:alpha:]*")) %>%
mutate(product_name = str_replace(product_name, "^- ", replacement = "")) %>%
mutate(product_title = str_replace(product_title, " -$", replacement = "")) %>%
select(!product)
toy_details
?rename
#toy_details <-
toys_weight %>%
mutate(product_name = str_extract(product, "- [:alpha:]+ ?[:alpha:]*")) %>%
mutate(product_title = str_extract(product, "^[:alpha:]*.?[:alpha:]*.?[:alpha:]*")) %>%
mutate(product_name = str_replace(product_name, "^- ", replacement = "")) %>%
mutate(product_title = str_replace(product_title, " -$", replacement = "")) %>%
select(!product) %>%
rename(toy_id = id)
#toy_details <-
toys_weight %>%
mutate(product_name = str_extract(product, "- [:alpha:]+ ?[:alpha:]*")) %>%
mutate(product_title = str_extract(product, "^[:alpha:]*.?[:alpha:]*.?[:alpha:]*")) %>%
mutate(product_name = str_replace(product_name, "^- ", replacement = "")) %>%
mutate(product_title = str_replace(product_title, " -$", replacement = "")) %>%
select(!product) %>%
rename(toy_id = id,
quality = quality_id)
#toy_details <-
toys_weight %>%
mutate(product_name = str_extract(product, "- [:alpha:]+ ?[:alpha:]*")) %>%
mutate(product_title = str_extract(product, "^[:alpha:]*.?[:alpha:]*.?[:alpha:]*")) %>%
mutate(product_name = str_replace(product_name, "^- ", replacement = "")) %>%
mutate(product_title = str_replace(product_title, " -$", replacement = "")) %>%
select(!product) %>%
rename(toy_id = id,
quality_id = quality)
toy_details <- toys_weight %>%
mutate(product_name = str_extract(product, "- [:alpha:]+ ?[:alpha:]*")) %>%
mutate(product_title = str_extract(product, "^[:alpha:]*.?[:alpha:]*.?[:alpha:]*")) %>%
mutate(product_name = str_replace(product_name, "^- ", replacement = "")) %>%
mutate(product_title = str_replace(product_title, " -$", replacement = "")) %>%
select(!product) %>%
rename(toy_id = id, quality_id = quality)
quality <- quality_raw %>%
mutate(description = str_replace(description, "^Quality: ", replacement = "")) %>%
# 2. Replace the categories so ‘Awesome’ and ‘Very Awesome’ become ‘Good’ and
# ‘Very Good’. Do the same thing for ‘Awful’ replacing it with ‘Bad’.
mutate(description = recode(description,
"Very Awesome" = "Very Good",
"Awesome" = "Good",
"Awful" = "Bad",
"Very Awful" = "Very Bad")) %>%
rename(quality_id = id)
quality
# create the dataframe combining all customer csv's
customers_all <- dir_ls("raw_data/", regexp = "customers.csv$") %>%
map_dfr(read_csv) %>%
rename(customer_id = id)
customers_all
customers <-
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE)))) %>%
rename(customer_id = id)
customers <-
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE)))) %>%
ungroup() %>%
rename(id = customer_id)
customers
customers <- customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE)))) %>%
ungroup() %>%
rename(id = customer_id)
customers
customers <- customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE)))) %>%
ungroup() %>%
rename(customer_id = id)
customers <- customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE)))) %>%
ungroup() #%>%
customers
customers <- customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE)))) %>%
ungroup()
customers
# create the dataframe combining all customer csv's
customers <- dir_ls("raw_data/", regexp = "customers.csv$") %>%
map_dfr(read_csv) %>%
rename(customer_id = id)
customers
transactions %>%
full_join(customers, by = customer_id) %>%
full_join(toy_details, by = toy_id) %>%
full_join(quality, by = quality_id)
transactions %>%
full_join(customers, by = "customer_id") %>%
full_join(toy_details, by = "toy_id") %>%
left_join(quality, by = "quality_id")
toys_joined <- transactions %>%
full_join(customers, by = "customer_id") %>%
full_join(toy_details, by = "toy_id") %>%
left_join(quality, by = "quality_id")
toys_joined
toys_joined %>%
mutate(first_name = str_sub(first_name, start = 1, end = 1))
toys_joined %>%
mutate(first_name = str_sub(first_name, start = 1, end = 1)) %>%
mutate(last_name = str_sub(last_name, start = 1, end = 1))
toys_joined_anonymous <- toys_joined %>%
mutate(first_name = str_sub(first_name, start = 1, end = 1)) %>%
mutate(last_name = str_sub(last_name, start = 1, end = 1))
toys_joined_anonymous
?write_csv
toys_joined_anonymous %>%
write_csv("toy_purchases_anonymous.csv")
customer_data <- dir_ls("raw_data/", regexp = "customers.csv$")
customer_data
customer_data <- dir_ls(regexp = "customers.csv$")
customer_data
ls
?ls
customer_data <- ls("raw_data/", regexp = "customers.csv$")
ls()
ls("raw_data/")
ls("raw_data/.")
ls("./raw_data")
ls("/raw_data")
ls("raw_data/")
ls()
dir_ls("raw_data/", regexp = "customers.csv$")
dir_ls("raw_data/", regexp = "customers.csv$") %>%
str_sub(start = 10)
?write_lines
ignore_customer_data <- dir_ls("raw_data/", regexp = "customers.csv$") %>%
str_sub(start = 10)
write_tsv(ignore_customer_data, "to_ignore.txt")
write_csv(ignore_customer_data, "to_ignore.csv")
dir_ls("raw_data/", regexp = "customers.csv$") %>%
str_sub(start = 10)
dir_ls("raw_data/", regexp = "customers.csv$") %>%
str_sub(start = 10) %>%
class()
dir_ls("raw_data/", regexp = "customers.csv$") %>%
str_sub(start = 10)
files_to_ignore <- dir_ls("raw_data/", regexp = "customers.csv$") %>%
str_sub(start = 10)
# write text file containing the names
writeLines(files_to_ignore, "ignore_files.txt")
# create the dataframe combining all customer csv's
customers_all <- dir_ls("raw_data/", regexp = "customers.csv$") %>%
map_dfr(read_csv) %>%
rename(customer_id = id)
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE)))) %>%
ungroup()
# first load libraries
library(tidyverse)
library(fs)
# create the dataframe combining all customer csv's
customers_all <- dir_ls("raw_data/", regexp = "customers.csv$") %>%
map_dfr(read_csv) %>%
rename(customer_id = id)
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(
across(where(is.numeric),
~ median(.x, na.rm = TRUE)))) %>%
ungroup()
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(across(where(is.numeric)), ~ median(.x, na.rm = TRUE) )
customers_all %>%
group_by(customer_gender, customer_country) #%>%
mutate(across(where(is.numeric)) = coalesce(across(where(is.numeric)), ~ median(.x, na.rm = TRUE) ))
mutate(across(where(is.numeric)) = coalesce(across(~ median(.x, na.rm = TRUE) )))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(across(where(is.numeric)) = coalesce(across(~ median(.x, na.rm = TRUE) )))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(across(where(is.numeric)) = coalesce(across(where(is.numeric)), ~ median(.x, na.rm = TRUE) ))
customers
customers_all
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(customer_age = coalesce(customer_age, median(.x, na.rm = TRUE) ))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(customer_age = coalesce(customer_age, median(customer_age, na.rm = TRUE) ))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(across(where(is.numeric)) = coalesce(across(where(is.numeric), ~ median(.x, na.rm = TRUE) )) )
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x, na.rm = TRUE) )) )
?coalesce
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ coalesce(median(.x, na.rm = TRUE)) )) )
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x, na.rm = TRUE))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ is.na(median(.x, na.rm = TRUE)))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ na_if(median(.x, na.rm = TRUE)))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(na_if(.x), na.rm = TRUE))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x, na.rm = TRUE))))
if.na()
?if.na()
?na_if()
?is.na()
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(is.na(.x), na.rm = TRUE))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(is.na(x), na.rm = TRUE))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(is.na(.x), na.rm = TRUE))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(is.na(.x), na.rm = FALSE))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x, na.rm = FALSE))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x, na.rm = TRUE))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x, na.rm = TRUE))), na.rm = TRUE)
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x, na.rm = TRUE))), na.rm = FALSE)
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(across(where(is.numeric)))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(across(where(is.numeric)), ~ median(.x, na.rm = TRUE))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(across(where(is.numeric)), median(.x, na.rm = TRUE))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric(NA)), ~ median(.x, na.rm = TRUE))))
mutate(coalesce(across(where(is.numeric, ~ median(.x, na.rm = TRUE))))
customers_all %>%
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric)), ~ median(.x, na.rm = TRUE))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric)), ~ median(.x, na.rm = TRUE))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric)), ~ median(.x, na.rm = TRUE)))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric)), ~ median(.x, na.rm = TRUE)))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(customer_age = coalesce(customer_age, median(customer_age, na.rm = TRUE) ))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x, na.rm = TRUE))))
?across
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(across(where(is.numeric), ~ median(is.na(.x))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(is.na(.x)))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(is.na(.x), na.rm = TRUE))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(is.na(.x), na.rm = FALSE))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x, na.rm = TRUE))))
?median
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x, na.rm = FALSE))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x, na.rm = TRUE
))))
customers_all %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x, na.rm = TRUE
))))
customers_all %>%
mutate(coalesce(across(is.na(where(is.numeric)), ~ median(.x, na.rm = TRUE
))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(is.na(where(is.numeric)), ~ median(.x, na.rm = TRUE
))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x, na.rm = TRUE
))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x, na.rm = TRUE
))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ is.na(median(.x, na.rm = TRUE
)))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ median(.x, na.rm = TRUE
))))
?if_na
?if.na
is.na()
?is.na()
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ is.na(median(.x, na.rm = TRUE
)))))
mutate(coalesce(across(where(is.numeric), ~ if_else(is.na(.x), median(.x, na.rm = TRUE
customers_all %>%
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ if_else(.x = NA, median(.x, na.rm = TRUE
)))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ if_else(is.na(x), median(.x, na.rm = TRUE
)))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(coalesce(across(where(is.numeric), ~ if_else(is.na(.x), median(.x, na.rm = TRUE
)))))
customers_all %>%
group_by(customer_gender, customer_country) %>%
mutate(across(where(is.numeric), ~ coalesce(., median(., na.rm = TRUE))))
